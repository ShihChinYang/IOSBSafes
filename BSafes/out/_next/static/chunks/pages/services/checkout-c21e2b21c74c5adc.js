(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2037],{87443:function(e,n,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/services/checkout",function(){return s(34449)}])},9321:function(e,n,s){"use strict";s.d(n,{Z:function(){return i}});var t=s(85893),a=s(67294),r=s(9473),o=s(2859),c=s(5960);function i(e){let{setStripePromise:n}=e,s=(0,r.v9)(e=>e.auth.stripePublishableKey);return(0,a.useEffect)(()=>{s&&((0,c.qu)(!1,"stripePublishableKey"),n((0,o.J)(s)))},[s]),(0,t.jsx)("p",{hidden:!0,children:"Load Stripe"})}},34449:function(e,n,s){"use strict";s.r(n),s.d(n,{default:function(){return g}});var t=s(85893),a=s(67294),r=s(9473),o=s(11163),c=s(97375),i=s(19101),l=s(68070),u=s(76720);s(86664);var d=s(34491);s(9321);var p=s(7069),h=s(87845),f=s(5960);function g(){let e=(0,o.useRouter)(),n=(0,r.I0)(),[s,g]=(0,a.useState)(null),[w,m]=(0,a.useState)(null),[A,b]=(0,a.useState)(null),[k,P]=(0,a.useState)(!1),[S,v]=(0,a.useState)(null),[I,x]=(0,a.useState)(null),[q,y]=(0,a.useState)(!1),E=(0,r.v9)(e=>e.auth.isLoggedIn),C=(0,r.v9)(e=>e.auth.memberId);(0,r.v9)(e=>e.account.stripeClientSecret);let j=(0,r.v9)(e=>e.account.appleClientSecret),N=(0,r.v9)(e=>e.account.androidClientSecret),O=(0,r.v9)(e=>e.account.checkoutItem),T=(0,r.v9)(e=>e.account.invoice),_=(0,r.v9)(e=>e.account.checkoutPlan),J=T&&T.planOptions,H=J&&J[_].planId;(0,f.qu)(!0,"isLoggedIn: ".concat(E,", checkoutPlan: ").concat(_));let M=e=>{(0,f.qu)(!0,"savePendingAppleTransaction - "),m(e);let n=localStorage.getItem("pendingAppleTransactions");(n=n&&"null"!==n?JSON.parse(n):{})[C]=e,n=JSON.stringify(n),localStorage.setItem("pendingAppleTransactions",n)},W=()=>{(0,f.qu)(!0,"clearPendingApppleTransaction - "),m(null);let e=localStorage.getItem("pendingAppleTransactions");(e=e&&"null"!==e?JSON.parse(e):{})[C]=null,e=JSON.stringify(e),localStorage.setItem("pendingAppleTransactions",e)},Z=e=>{(0,f.qu)(!0,"savePendingAndroidPurchase - "),v(e);let n=localStorage.getItem("pendingAndroidPurchases");(n=n&&"null"!==n?JSON.parse(n):{})[C]=JSON.stringify(e),n=JSON.stringify(n),localStorage.setItem("pendingAndroidPurchases",n)},X=()=>{(0,f.qu)(!0,"clearPendingAndroidPurchase - "),v(null);let e=localStorage.getItem("pendingAndroidPurchases");e=e&&"null"!==e?JSON.parse(e):{},(0,f.qu)(!0,"clearPendingAndroidPurchase - "),e[C]=null,e=JSON.stringify(e),localStorage.setItem("pendingAndroidPurchases",e),(0,f.qu)(!0,"clearPendingAndroidPurchase finished. ")},L=e=>{"ok"===e.status?(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.toggleMessageHandler&&window.webkit.messageHandlers.toggleMessageHandler.postMessage({action:"finishTransaction"}),W(),P(!0)):(console.log("reportAnAppleTransactionCallback returns error, pending: ",w),b(e.error))},Y=s=>{(0,f.qu)(!0,"transactionWebCall",s);let t=s.transaction;"ok"===s.status?M(t):e.push("/services/payment"),n((0,h.Xz)(p.op.IOSInAppPurchase))},z=e=>{(0,f.qu)("reportAnAndroidPurchaseCallback - ",e.status),"ok"===e.status?(window.Android&&(console.log("finishPurchase"),window.Android.finishPurchase(H.toLowerCase())),X(),y(!0)):(console.log("reportAnAndroidPurchaseCallback returns error, pending: ",S),x(e.error))},G=s=>{if((0,f.qu)(!0,"transactionWebCall"),"ok"===s.status){let e=JSON.parse(s.purchase);(0,f.qu)(!0,"purchase: ",e),Z(e)}else"canceled"===s.status?e.push("/services/payment"):"error"==s.status&&e.push("/services/payment");n((0,h.Xz)(p.op.AndroidInAppPurchase))};return(0,a.useEffect)(()=>{E&&_&&((0,f.qu)(!0,"createApplePaymentIntentThunk"),n((0,h.fM)({checkoutPlan:_})),n((0,h.Pe)({checkoutPlan:_})))},[E,_]),(0,a.useEffect)(()=>{w&&((0,f.qu)(!0,"useEffect - pendingAppleTransaction: ",w),n((0,h.cK)({transaction:w,callback:L})))},[w]),(0,a.useEffect)(()=>{k&&((0,f.qu)(!0,"Apple transaction is completed."),e.push("/services/inAppPurchaseCompletion"))},[k]),(0,a.useEffect)(()=>{A&&(0,f.qu)(!0,"useEffect - reportAnAppleTransactionErrorn: ",A)},[A]),(0,a.useEffect)(()=>{S&&((0,f.qu)(!0,"useEffect - pendingAndroidPurchase: ",S),n((0,h.IM)({purchase:S,callback:z})))},[S]),(0,a.useEffect)(()=>{q&&((0,f.qu)(!0,"Android purchase is completed."),e.push("/services/inAppPurchaseCompletion"))},[q]),(0,a.useEffect)(()=>{I&&(0,f.qu)(!0,"useEffect - reportAnAndroidPurchaseError: ",I)},[I]),(0,a.useEffect)(()=>{(0,f.qu)(!0,"appleCientSecret: ",j),j&&(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.toggleMessageHandler&&(console.log("checkout"),n((0,h.z8)(p.op.IOSInAppPurchase)),window.bsafesNative.transactionWebCall=Y,window.webkit.messageHandlers.toggleMessageHandler.postMessage({action:"checkout",planId:H,appleClientSecret:j})),n((0,h.GY)()))},[j]),(0,a.useEffect)(()=>{(0,f.qu)(!0,"androidCientSecret: ",N),N&&(window.Android?(console.log("checkout"),n((0,h.z8)(p.op.AndroidInAppPurchase)),window.bsafesAndroid.transactionWebCall=G,window.Android.initiatePurchase(H.toLowerCase())):G({status:"ok",purchase:'{"orderId":"GPA.3351-4344-3420-01214","packageName":"com.bsafes.android.bsafes","productId":"bsafes_001","purchaseTime":1730092798870,"purchaseState":0,"purchaseToken":"ocikmbelnoiflbmgonehogeb.AO-J1OxvnDznYogJk0jliUCMcmyWDa8kcmNRoX_2mbYG8F0Ey6t5XdvdEoiLR5WoCMUOb2N0m_o9k25YTu0meiqY24m4TxAlvH-oqsjI9XQrEe0odPoljGU","quantity":1,"acknowledged":false}'}),n((0,h.GY)()))},[N]),(0,t.jsxs)(d.Z,{showNaveBar:!1,children:[(0,t.jsxs)(c.Z,{children:[(0,t.jsx)("br",{}),(0,t.jsx)("br",{}),(0,t.jsx)(i.Z,{children:(0,t.jsx)(l.Z,{xs:{span:12},sm:{span:10,offset:1},md:{span:8,offset:2},lg:{span:6,offset:3},children:(0,t.jsx)("div",{style:{borderStyle:"solid"},className:"p-3",children:O&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:"Total Amount:"}),(0,t.jsx)("h4",{children:"$".concat((O.amount/100).toFixed(2)," ").concat(O.currency.toUpperCase())})]})})})}),!1,(0,t.jsx)("br",{}),(A&&!A.startsWith("Invalid transaction")||!1)&&(0,t.jsx)(i.Z,{children:(0,t.jsxs)(l.Z,{xs:{span:12},sm:{span:10,offset:1},md:{span:8,offset:2},lg:{span:6,offset:3},children:["Many thanks for your purchase. We're sorry we failed to complete it due to a"," ",(0,t.jsx)("span",{style:{fontWeight:"bold"},children:A||I}),". ","Please try again, and we will not ask you to pay.",(0,t.jsx)("br",{}),(0,t.jsx)("br",{}),(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)(u.Z,{onClick:()=>{b(null),n((0,h.cK)({transaction:w,callback:L}))},children:"Fix It"})})]})})]}),!1]})}}},function(e){e.O(0,[3424,8999,7753,8491,4491,2888,9774,179],function(){return e(e.s=87443)}),_N_E=e.O()}]);